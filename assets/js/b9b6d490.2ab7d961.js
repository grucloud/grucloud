"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[17724],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=a.createContext({}),p=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),m=r,g=d["".concat(i,".").concat(m)]||d[m]||u[m]||o;return t?a.createElement(g,s(s({ref:n},c),{},{components:t})):a.createElement(g,s({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,s=new Array(o);s[0]=d;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var p=2;p<o;p++)s[p]=t[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},75969:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const o={id:"K8sGettingStarted",title:"Kubernetes Getting Started"},s=void 0,l={unversionedId:"k8s/K8sGettingStarted",id:"k8s/K8sGettingStarted",title:"Kubernetes Getting Started",description:"Introduction",source:"@site/docs/k8s/K8sGettingStarted.md",sourceDirName:"k8s",slug:"/k8s/K8sGettingStarted",permalink:"/docs/k8s/K8sGettingStarted",draft:!1,tags:[],version:"current",frontMatter:{id:"K8sGettingStarted",title:"Kubernetes Getting Started"},sidebar:"docs",previous:{title:"Azure Getting Started",permalink:"/docs/azure/AzureGettingStarted"},next:{title:"Resources List",permalink:"/docs/aws/ResourcesList"}},i={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Getting GruCloud CLI: gc",id:"getting-grucloud-cli-gc",level:3},{value:"Project Content",id:"project-content",level:2},{value:"package.json",id:"packagejson",level:3},{value:"config.js",id:"configjs",level:3},{value:"iac.js",id:"iacjs",level:3},{value:"hook.js",id:"hookjs",level:3},{value:"Workflow",id:"workflow",level:2},{value:"Deploy",id:"deploy",level:3},{value:"List",id:"list",level:3},{value:"Post Deploy Hook",id:"post-deploy-hook",level:3},{value:"Update",id:"update",level:3},{value:"Destroy",id:"destroy",level:3},{value:"Debugging",id:"debugging",level:2},{value:"Conclusion",id:"conclusion",level:2}],c={toc:p};function u(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"The Kubernetes Grucloud provider allows to define and describe Kubernetes manifests in Javascript, removing the need to write YAML or template files."),(0,r.kt)("p",null,"The GruCloud Command Line Interface ",(0,r.kt)("strong",{parentName:"p"},"gc")," reads a description in Javascript and connects to the k8s control plane to apply the new or updated resource definitions."),(0,r.kt)("p",null,"For this tutorial, we will define a ",(0,r.kt)("a",{parentName:"p",href:"https://www.grucloud.com/docs/k8s/resources/Namespace"},"Namespace"),", a ",(0,r.kt)("a",{parentName:"p",href:"https://www.grucloud.com/docs/k8s/resources/Service"},"Service"),", and a ",(0,r.kt)("a",{parentName:"p",href:"https://www.grucloud.com/docs/k8s/resources/Deployment"},"Deployment")," to deploy an Nginx web server."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/grucloud/grucloud/main/examples/k8s/tuto1/artifacts/diagram-target.svg",alt:"diagram-target"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This diagram is generated from the code with ",(0,r.kt)("inlineCode",{parentName:"p"},"gc graph"))),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"Ensure ",(0,r.kt)("strong",{parentName:"p"},"kubectl")," is installed, and ",(0,r.kt)("strong",{parentName:"p"},"minikube")," is started: ",(0,r.kt)("a",{parentName:"p",href:"/docs/k8s/K8sRequirements"},"K8s Requirements")),(0,r.kt)("p",null,"It is always a good idea to verify the current ",(0,r.kt)("em",{parentName:"p"},"kubectl")," context, especially when switching k8s clusters:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl config current-context\n")),(0,r.kt)("h3",{id:"getting-grucloud-cli-gc"},"Getting GruCloud CLI: gc"),(0,r.kt)("p",null,"The GruCloud CLI, ",(0,r.kt)("inlineCode",{parentName:"p"},"gc"),", is written in Javascript and run on ",(0,r.kt)("a",{parentName:"p",href:"https://nodejs.org/"},"Node.js"),", hence ",(0,r.kt)("em",{parentName:"p"},"node")," is required:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"node --version\n")),(0,r.kt)("p",null,"Install ",(0,r.kt)("inlineCode",{parentName:"p"},"gc")," in just one command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i -g @grucloud/core\n")),(0,r.kt)("p",null,"Verify ",(0,r.kt)("em",{parentName:"p"},"gc")," is installed properly by displaying the version:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"gc --version\n")),(0,r.kt)("h2",{id:"project-content"},"Project Content"),(0,r.kt)("p",null,"We'll describe in the next sections the 4 files required for this ",(0,r.kt)("em",{parentName:"p"},"infrastructure as code")," project:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/package.json"},"package.json")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/config.js"},"config.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/iac.js"},"iac.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/hook.js"},"hook.js"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The link to the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/grucloud/grucloud/tree/main/examples/k8s/tuto1"},"source code for this tutorial"))),(0,r.kt)("p",null,"Let's create a new project directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"mkdir tuto\ncd tuto\n")),(0,r.kt)("h3",{id:"packagejson"},"package.json"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"npm init")," command will create a basic ",(0,r.kt)("em",{parentName:"p"},"package.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"npm init\n")),(0,r.kt)("p",null,"Let's install the ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@grucloud/provider-k8s"},"GruCloud Kubernetes provider")," and the SDK. We'll also install ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/axios/axios"},"axios")," and ",(0,r.kt)("a",{parentName:"p",href:"https://rubico.land/"},"rubico"),", needed for the post-deployment hooks, which does some final health check."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"npm install @grucloud/core @grucloud/provider-k8s rubico axios\n")),(0,r.kt)("h3",{id:"configjs"},"config.js"),(0,r.kt)("p",null,"Create the ",(0,r.kt)("strong",{parentName:"p"},"config.js")," which contains the configuration for this project:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// config.js\nconst pkg = require("./package.json");\nmodule.exports = () => ({\n  projectName: pkg.name,\n  namespace: "myapp",\n  appLabel: "nginx-label",\n  service: { name: "nginx-service" },\n  deployment: {\n    name: "nginx-deployment",\n    container: { name: "nginx", image: "nginx:1.14.2" },\n  },\n});\n')),(0,r.kt)("h3",{id:"iacjs"},"iac.js"),(0,r.kt)("p",null,"Let's create the ",(0,r.kt)("em",{parentName:"p"},"iac.js")," with the following content:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// iac.js\nconst { K8sProvider } = require("@grucloud/provider-k8s");\n\n// Create a namespace, service and deployment\nconst createResources = async ({ provider }) => {\n  const { config } = provider;\n\n  const namespace = provider.makeNamespace({\n    properties: ({}) => ({\n      metadata: {\n        name: config.namespace,\n      },\n    }),\n  });\n\n  const service = provider.makeService({\n    name: config.service.name,\n    properties: () => ({\n      metadata: {\n        name: config.service.name,\n        namespace: config.namespace,\n      },\n      spec: {\n        selector: {\n          app: config.appLabel,\n        },\n        type: "NodePort",\n        ports: [\n          {\n            protocol: "TCP",\n            port: 80,\n            targetPort: 80,\n            nodePort: 30020,\n          },\n        ],\n      },\n    }),\n  });\n\n  const deployment = provider.makeDeployment({\n    properties: ({}) => ({\n      metadata: {\n        name: config.deployment.name,\n        namespace: config.namespace,\n        labels: {\n          app: config.appLabel,\n        },\n      },\n      spec: {\n        replicas: 1,\n        selector: {\n          matchLabels: {\n            app: config.appLabel,\n          },\n        },\n        template: {\n          metadata: {\n            labels: {\n              app: config.appLabel,\n            },\n          },\n          spec: {\n            containers: [\n              {\n                name: config.deployment.container.name,\n                image: config.deployment.container.image,\n                ports: [\n                  {\n                    containerPort: 80,\n                  },\n                ],\n              },\n            ],\n          },\n        },\n      },\n    }),\n  });\n\n  return { namespace, service, deployment };\n};\n\nexports.createStack = async ({ createProvider }) => {\n  return {\n    provider: createProvider(K8sProvider, {\n      createResources,\n      config: require("./config"),\n    }),\n    hooks: [require("./hook")],\n  };\n};\n')),(0,r.kt)("h3",{id:"hookjs"},"hook.js"),(0,r.kt)("p",null,"When the resources are created, any code can be invoked, defined in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/hook.js"},"hook.js"),", useful to perform some final health check."),(0,r.kt)("p",null,"In this case, the ",(0,r.kt)("em",{parentName:"p"},"kubectl port-forward")," is called with the right option:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl --namespace myapp port-forward svc/nginx-service 8081:80\n")),(0,r.kt)("p",null,"Then, we'll use the ",(0,r.kt)("em",{parentName:"p"},"axios")," library to perform HTTP calls to the web server, retrying if necessary."),(0,r.kt)("p",null,"When the website is up, it will open a browser at ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:8081"},"http://localhost:8081")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// hook.js\nconst assert = require("assert");\nconst Axios = require("axios");\nconst { pipe, tap, eq, get, or } = require("rubico");\nconst { first } = require("rubico/x");\nconst { retryCallOnError } = require("@grucloud/core").Retry;\nconst shell = require("shelljs");\n\nmodule.exports = ({ resources, provider }) => {\n  const localPort = 8081;\n  const url = `http://localhost:${localPort}`;\n\n  const servicePort = pipe([\n    () => resources.service.properties({}),\n    get("spec.ports"),\n    first,\n    get("port"),\n  ])();\n\n  const kubectlPortForwardCommand = `kubectl --namespace ${resources.namespace.name} port-forward svc/${resources.service.name} ${localPort}:${servicePort}`;\n\n  const axios = Axios.create({\n    timeout: 15e3,\n    withCredentials: true,\n  });\n\n  return {\n    onDeployed: {\n      init: async () => {},\n      actions: [\n        {\n          name: `exec: \'${kubectlPortForwardCommand}\', check web server at ${url}`,\n          command: async () => {\n            // start kubectl port-forward\n            var child = shell.exec(kubectlPortForwardCommand, { async: true });\n            child.stdout.on("data", function (data) {});\n\n            // Get the web page, retry until it succeeds\n            await retryCallOnError({\n              name: `get ${url}`,\n              fn: () => axios.get(url),\n              shouldRetryOnException: ({ error }) =>\n                or([\n                  eq(get("code"), "ECONNREFUSED"),\n                  eq(get("response.status"), 404),\n                ])(error),\n              isExpectedResult: (result) => {\n                assert(result.headers["content-type"], `text/html`);\n                return [200].includes(result.status);\n              },\n              config: { retryCount: 20, retryDelay: 5e3 },\n            });\n            // Open a browser\n            shell.exec(`open ${url}`, { async: true });\n          },\n        },\n      ],\n    },\n    onDestroyed: {\n      init: () => {},\n    },\n  };\n};\n')),(0,r.kt)("h2",{id:"workflow"},"Workflow"),(0,r.kt)("p",null,"We'll describe the most useful ",(0,r.kt)("em",{parentName:"p"},"gc")," commands: ",(0,r.kt)("inlineCode",{parentName:"p"},"apply"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"list"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"destroy"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"plan"),"."),(0,r.kt)("h3",{id:"deploy"},"Deploy"),(0,r.kt)("p",null,"We are now ready to deploy the resources with the ",(0,r.kt)("a",{parentName:"p",href:"https://www.grucloud.com/docs/cli/PlanApply"},"apply")," command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"gc apply\n")),(0,r.kt)("p",null,"The first part is to find out the plan, i.e what is going to be deployed.\nYou will be prompted if you accept or abort.\nWhen typing: 'y', the resources will be deployed: a namespace, a service, and a deployment."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},'Querying resources on 1 provider: k8s\n\u2713 k8s\n  \u2713 Initialising\n  \u2713 Listing 7/7\n  \u2713 Querying\n    \u2713 Namespace 1/1\n    \u2713 Service 1/1\n    \u2713 Deployment 1/1\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1 Namespace from k8s                                                                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Name     \u2502 Action   \u2502 Data                                                                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 myapp    \u2502 CREATE   \u2502 apiVersion: v1                                                                 \u2502\n\u2502          \u2502          \u2502 kind: Namespace                                                                \u2502\n\u2502          \u2502          \u2502 metadata:                                                                      \u2502\n\u2502          \u2502          \u2502   name: myapp                                                                  \u2502\n\u2502          \u2502          \u2502   annotations:                                                                 \u2502\n\u2502          \u2502          \u2502     Name: myapp                                                                \u2502\n\u2502          \u2502          \u2502     ManagedBy: GruCloud                                                        \u2502\n\u2502          \u2502          \u2502     CreatedByProvider: k8s                                                     \u2502\n\u2502          \u2502          \u2502     stage: dev                                                                 \u2502\n\u2502          \u2502          \u2502     projectName: @grucloud/example-k8s-tuto1                                   \u2502\n\u2502          \u2502          \u2502                                                                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1 Service from k8s                                                                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Name                 \u2502 Action   \u2502 Data                                                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 myapp::nginx-service \u2502 CREATE   \u2502 spec:                                                              \u2502\n\u2502                      \u2502          \u2502   selector:                                                        \u2502\n\u2502                      \u2502          \u2502     app: nginx-label                                               \u2502\n\u2502                      \u2502          \u2502   type: NodePort                                                   \u2502\n\u2502                      \u2502          \u2502   ports:                                                           \u2502\n\u2502                      \u2502          \u2502     - protocol: TCP                                                \u2502\n\u2502                      \u2502          \u2502       port: 80                                                     \u2502\n\u2502                      \u2502          \u2502       targetPort: 8080                                             \u2502\n\u2502                      \u2502          \u2502 apiVersion: v1                                                     \u2502\n\u2502                      \u2502          \u2502 kind: Service                                                      \u2502\n\u2502                      \u2502          \u2502 metadata:                                                          \u2502\n\u2502                      \u2502          \u2502   name: nginx-service                                              \u2502\n\u2502                      \u2502          \u2502   annotations:                                                     \u2502\n\u2502                      \u2502          \u2502     Name: nginx-service                                            \u2502\n\u2502                      \u2502          \u2502     ManagedBy: GruCloud                                            \u2502\n\u2502                      \u2502          \u2502     CreatedByProvider: k8s                                         \u2502\n\u2502                      \u2502          \u2502     stage: dev                                                     \u2502\n\u2502                      \u2502          \u2502     projectName: @grucloud/example-k8s-tuto1                       \u2502\n\u2502                      \u2502          \u2502   namespace: myapp                                                 \u2502\n\u2502                      \u2502          \u2502                                                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1 Deployment from k8s                                                                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Name                    \u2502 Action   \u2502 Data                                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 myapp::nginx-deployment \u2502 CREATE   \u2502 metadata:                                                       \u2502\n\u2502                         \u2502          \u2502   labels:                                                       \u2502\n\u2502                         \u2502          \u2502     app: nginx-label                                            \u2502\n\u2502                         \u2502          \u2502   name: nginx-deployment                                        \u2502\n\u2502                         \u2502          \u2502   annotations:                                                  \u2502\n\u2502                         \u2502          \u2502     Name: nginx-deployment                                      \u2502\n\u2502                         \u2502          \u2502     ManagedBy: GruCloud                                         \u2502\n\u2502                         \u2502          \u2502     CreatedByProvider: k8s                                      \u2502\n\u2502                         \u2502          \u2502     stage: dev                                                  \u2502\n\u2502                         \u2502          \u2502     projectName: @grucloud/example-k8s-tuto1                    \u2502\n\u2502                         \u2502          \u2502   namespace: myapp                                              \u2502\n\u2502                         \u2502          \u2502 spec:                                                           \u2502\n\u2502                         \u2502          \u2502   replicas: 1                                                   \u2502\n\u2502                         \u2502          \u2502   selector:                                                     \u2502\n\u2502                         \u2502          \u2502     matchLabels:                                                \u2502\n\u2502                         \u2502          \u2502       app: nginx-label                                          \u2502\n\u2502                         \u2502          \u2502   template:                                                     \u2502\n\u2502                         \u2502          \u2502     metadata:                                                   \u2502\n\u2502                         \u2502          \u2502       labels:                                                   \u2502\n\u2502                         \u2502          \u2502         app: nginx-label                                        \u2502\n\u2502                         \u2502          \u2502     spec:                                                       \u2502\n\u2502                         \u2502          \u2502       containers:                                               \u2502\n\u2502                         \u2502          \u2502         - name: nginx                                           \u2502\n\u2502                         \u2502          \u2502           image: nginx:1.14.2                                   \u2502\n\u2502                         \u2502          \u2502           ports:                                                \u2502\n\u2502                         \u2502          \u2502             - containerPort: 80                                 \u2502\n\u2502                         \u2502          \u2502 apiVersion: apps/v1                                             \u2502\n\u2502                         \u2502          \u2502 kind: Deployment                                                \u2502\n\u2502                         \u2502          \u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Plan summary for provider k8s                                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 DEPLOY RESOURCES                                                                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Namespace          \u2502 myapp                                                                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Service            \u2502 myapp::nginx-service                                                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Deployment         \u2502 myapp::nginx-deployment                                                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2714 Are you sure to deploy 3 resources, 3 types on 1 provider? \u2026 yes\nDeploying resources on 1 provider: k8s\n\u2713 k8s\n  \u2713 Initialising\n  \u2713 Deploying\n    \u2713 Namespace 1/1\n    \u2713 Service 1/1\n    \u2713 Deployment 1/1\n3 resources deployed of 3 types and 1 provider\nRunning OnDeployedGlobal resources on 1 provider: k8s\nCommand "gc a" executed in 30s\n')),(0,r.kt)("p",null,"In the case of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Deployment")," type manifest, ",(0,r.kt)("strong",{parentName:"p"},"gc")," will query the pod that is started by the deployment through the replica set, when one of the container's pod is ready, the deployment can proceed."),(0,r.kt)("p",null,"Later on, when we deal with the ",(0,r.kt)("inlineCode",{parentName:"p"},"Ingress")," type, ",(0,r.kt)("strong",{parentName:"p"},"gc")," will wait for the load balancer to be ready."),(0,r.kt)("p",null,"The command ",(0,r.kt)("inlineCode",{parentName:"p"},"gc apply")," is the equivalent of ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl apply -f mymanifest.yaml")," but it waits for resources to be up and running, ready to serve."),(0,r.kt)("p",null,"We could try to run the ",(0,r.kt)("inlineCode",{parentName:"p"},"gc apply")," or the ",(0,r.kt)("inlineCode",{parentName:"p"},"gc plan"),", we should not expect any deployment or destruction of resources."),(0,r.kt)("p",null,"In the mathematical and computer science world, we could say that ",(0,r.kt)("em",{parentName:"p"},"apply")," (and ",(0,r.kt)("em",{parentName:"p"},"destroy"),") commands are ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Idempotence"},"idempotent"),': "property of certain operations in mathematics and computer science whereby they can be applied multiple times without changing the result beyond the initial application".'),(0,r.kt)("h3",{id:"list"},"List"),(0,r.kt)("p",null,"Let's verify that the resources are deployed with the ",(0,r.kt)("em",{parentName:"p"},"gc list")," command:"),(0,r.kt)("p",null,"A live diagram will be also generated."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"gc list --our --all --graph\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},'List Summary:\nProvider: k8s\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 k8s                                                                                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Namespace          \u2502 myapp                                                                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Service            \u2502 myapp::nginx-service                                                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Deployment         \u2502 myapp::nginx-deployment                                                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 ReplicaSet         \u2502 myapp::nginx-deployment-66cdc8d56b                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Pod                \u2502 myapp::nginx-deployment-66cdc8d56b-4d8lz                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n5 resources, 15 types, 1 provider\nCommand "gc list --our --all --graph" executed in 0s\n')),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/grucloud/grucloud/main/examples/k8s/tuto1/artifacts/diagram-live.svg",alt:"diagram-live"})),(0,r.kt)("p",null,"Notice the relationship between the Pod, ReplicaSet and Deployment."),(0,r.kt)("p",null,"The Deployment creates a ReplicaSet which creates a one or more Pod(s)."),(0,r.kt)("p",null,"When querying the ",(0,r.kt)("em",{parentName:"p"},"k8s-api-server")," for the live resources, the pod contains information about its ReplicaSet parent, who has itself information about its parent Deployment. This allows ",(0,r.kt)("em",{parentName:"p"},"gc")," to find out the links between the resources."),(0,r.kt)("h3",{id:"post-deploy-hook"},"Post Deploy Hook"),(0,r.kt)("p",null,"Would like to check the health of the system? You can run the ",(0,r.kt)("em",{parentName:"p"},"onDeployed")," hook any time with the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"gc run --onDeployed\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"Running OnDeployed resources on 1 provider: k8s\nForwarding from 127.0.0.1:8081 -> 80\nForwarding from [::1]:8081 -> 80\nHandling connection for 8081\n\u2713 k8s\n  \u2713 Initialising\n  \u2713 default::onDeployed\n    \u2713 exec: 'kubectl --namespace myapp port-forward svc/nginx-service 8081:80', check web server at http://localhost:8081\nCommand \"gc run --onDeployed\" executed in 5s\n")),(0,r.kt)("h3",{id:"update"},"Update"),(0,r.kt)("p",null,"Now that the initial deployment is successful, some changes will be made, for instance, let's change the Nginx container version, located at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/config.js"},"config.js"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Browse the list of Nginx images at ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/_/nginx"},"https://hub.docker.com/_/nginx"))),(0,r.kt)("p",null,"Let's try the version ",(0,r.kt)("inlineCode",{parentName:"p"},"nginx:1.20.0-alpine"),"."),(0,r.kt)("p",null,"For a preview of the change that will be made, use the ",(0,r.kt)("em",{parentName:"p"},"plan")," command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"gc plan\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},"Querying resources on 1 provider: k8s\n\u2713 k8s\n  \u2713 Initialising\n  \u2713 Listing 7/7\n  \u2713 Querying\n    \u2713 Namespace 1/1\n    \u2713 Service 1/1\n    \u2713 Deployment 1/1\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1 Deployment from k8s                                                                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Name                    \u2502 Action   \u2502 Data                                                                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 myapp::nginx-deployment \u2502 UPDATE   \u2502 added:                                                                       \u2502\n\u2502                         \u2502          \u2502 deleted:                                                                     \u2502\n\u2502                         \u2502          \u2502 updated:                                                                     \u2502\n\u2502                         \u2502          \u2502   spec:                                                                      \u2502\n\u2502                         \u2502          \u2502     template:                                                                \u2502\n\u2502                         \u2502          \u2502       spec:                                                                  \u2502\n\u2502                         \u2502          \u2502         containers:                                                          \u2502\n\u2502                         \u2502          \u2502           0:                                                                 \u2502\n\u2502                         \u2502          \u2502             image: nginx:1.20.0-alpine                                       \u2502\n\u2502                         \u2502          \u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Plan summary for provider k8s                                                                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 DEPLOY RESOURCES                                                                                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Deployment         \u2502 myapp::nginx-deployment                                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n? Are you sure to deploy 1 resource, 1 type on 1 provider? \u203a (y/N)\n")),(0,r.kt)("p",null,"Notice this time the action is not ",(0,r.kt)("inlineCode",{parentName:"p"},"CREATE")," but ",(0,r.kt)("inlineCode",{parentName:"p"},"UPDATE"),". ",(0,r.kt)("strong",{parentName:"p"},"gc")," fetched the live resources from the ",(0,r.kt)("em",{parentName:"p"},"kubernetes-api-server"),", compared them with the target resources defined in the code, and has found out the deployment needs to be updated."),(0,r.kt)("p",null,"Now we can apply the change:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"gc apply\n")),(0,r.kt)("p",null,"The updated Nginx image should be up and running."),(0,r.kt)("p",null,"Let's double-check the state of the Nginx deployment, filtering by ",(0,r.kt)("em",{parentName:"p"},"type")," and ",(0,r.kt)("em",{parentName:"p"},"name")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"gc list -t Deployment --name nginx-deployment\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},'Listing resources on 1 provider: k8s\n\u2713 k8s\n  \u2713 Initialising\n  \u2713 Listing 6/6\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 1 Deployment from k8s                                                                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Name                    \u2502 Data                                                                             \u2502 Our  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 myapp::nginx-deployment \u2502 metadata:                                                                        \u2502 Yes  \u2502\n\u2502                         \u2502   name: nginx-deployment                                                         \u2502      \u2502\n\u2502                         \u2502   namespace: myapp                                                               \u2502      \u2502\n\u2502                         \u2502   uid: 7c9bf366-cbf4-47d9-a7b7-e3da900b75dc                                      \u2502      \u2502\n\u2502                         \u2502   resourceVersion: 7111                                                          \u2502      \u2502\n\u2502                         \u2502   generation: 2                                                                  \u2502      \u2502\n\u2502                         \u2502   creationTimestamp: 2021-04-28T19:51:37Z                                        \u2502      \u2502\n\u2502                         \u2502   labels:                                                                        \u2502      \u2502\n\u2502                         \u2502     app: nginx-label                                                             \u2502      \u2502\n\u2502                         \u2502   annotations:                                                                   \u2502      \u2502\n\u2502                         \u2502     CreatedByProvider: k8s                                                       \u2502      \u2502\n\u2502                         \u2502     ManagedBy: GruCloud                                                          \u2502      \u2502\n\u2502                         \u2502     Name: nginx-deployment                                                       \u2502      \u2502\n\u2502                         \u2502     deployment.kubernetes.io/revision: 2                                         \u2502      \u2502\n\u2502                         \u2502     projectName: @grucloud/example-k8s-tuto1                                     \u2502      \u2502\n\u2502                         \u2502     stage: dev                                                                   \u2502      \u2502\n\u2502                         \u2502 spec:                                                                            \u2502      \u2502\n\u2502                         \u2502   replicas: 1                                                                    \u2502      \u2502\n\u2502                         \u2502   selector:                                                                      \u2502      \u2502\n\u2502                         \u2502     matchLabels:                                                                 \u2502      \u2502\n\u2502                         \u2502       app: nginx-label                                                           \u2502      \u2502\n\u2502                         \u2502   template:                                                                      \u2502      \u2502\n\u2502                         \u2502     metadata:                                                                    \u2502      \u2502\n\u2502                         \u2502       creationTimestamp: null                                                    \u2502      \u2502\n\u2502                         \u2502       labels:                                                                    \u2502      \u2502\n\u2502                         \u2502         app: nginx-label                                                         \u2502      \u2502\n\u2502                         \u2502     spec:                                                                        \u2502      \u2502\n\u2502                         \u2502       containers:                                                                \u2502      \u2502\n\u2502                         \u2502         - name: nginx                                                            \u2502      \u2502\n\u2502                         \u2502           image: nginx:1.20.0-alpine                                             \u2502      \u2502\n\u2502                         \u2502           ports:                                                                 \u2502      \u2502\n\u2502                         \u2502             - containerPort: 80                                                  \u2502      \u2502\n\u2502                         \u2502               protocol: TCP                                                      \u2502      \u2502\n\u2502                         \u2502           resources:                                                             \u2502      \u2502\n\u2502                         \u2502           terminationMessagePath: /dev/termination-log                           \u2502      \u2502\n\u2502                         \u2502           terminationMessagePolicy: File                                         \u2502      \u2502\n\u2502                         \u2502           imagePullPolicy: IfNotPresent                                          \u2502      \u2502\n\u2502                         \u2502       restartPolicy: Always                                                      \u2502      \u2502\n\u2502                         \u2502       terminationGracePeriodSeconds: 30                                          \u2502      \u2502\n\u2502                         \u2502       dnsPolicy: ClusterFirst                                                    \u2502      \u2502\n\u2502                         \u2502       securityContext:                                                           \u2502      \u2502\n\u2502                         \u2502       schedulerName: default-scheduler                                           \u2502      \u2502\n\u2502                         \u2502   strategy:                                                                      \u2502      \u2502\n\u2502                         \u2502     type: RollingUpdate                                                          \u2502      \u2502\n\u2502                         \u2502     rollingUpdate:                                                               \u2502      \u2502\n\u2502                         \u2502       maxUnavailable: 25%                                                        \u2502      \u2502\n\u2502                         \u2502       maxSurge: 25%                                                              \u2502      \u2502\n\u2502                         \u2502   revisionHistoryLimit: 10                                                       \u2502      \u2502\n\u2502                         \u2502   progressDeadlineSeconds: 600                                                   \u2502      \u2502\n\u2502                         \u2502 status:                                                                          \u2502      \u2502\n\u2502                         \u2502   observedGeneration: 2                                                          \u2502      \u2502\n\u2502                         \u2502   replicas: 1                                                                    \u2502      \u2502\n\u2502                         \u2502   updatedReplicas: 1                                                             \u2502      \u2502\n\u2502                         \u2502   readyReplicas: 1                                                               \u2502      \u2502\n\u2502                         \u2502   availableReplicas: 1                                                           \u2502      \u2502\n\u2502                         \u2502   conditions:                                                                    \u2502      \u2502\n\u2502                         \u2502     - type: Available                                                            \u2502      \u2502\n\u2502                         \u2502       status: True                                                               \u2502      \u2502\n\u2502                         \u2502       lastUpdateTime: 2021-04-28T19:51:39Z                                       \u2502      \u2502\n\u2502                         \u2502       lastTransitionTime: 2021-04-28T19:51:39Z                                   \u2502      \u2502\n\u2502                         \u2502       reason: MinimumReplicasAvailable                                           \u2502      \u2502\n\u2502                         \u2502       message: Deployment has minimum availability.                              \u2502      \u2502\n\u2502                         \u2502     - type: Progressing                                                          \u2502      \u2502\n\u2502                         \u2502       status: True                                                               \u2502      \u2502\n\u2502                         \u2502       lastUpdateTime: 2021-04-28T20:03:08Z                                       \u2502      \u2502\n\u2502                         \u2502       lastTransitionTime: 2021-04-28T19:51:37Z                                   \u2502      \u2502\n\u2502                         \u2502       reason: NewReplicaSetAvailable                                             \u2502      \u2502\n\u2502                         \u2502       message: ReplicaSet "nginx-deployment-675bd9f4f7" has successfully progre\u2026 \u2502      \u2502\n\u2502                         \u2502                                                                                  \u2502      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\nList Summary:\nProvider: k8s\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 k8s                                                                                                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Deployment         \u2502 myapp::nginx-deployment                                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n1 resource, 5 types, 1 provider\nCommand "gc list -t Deployment --name nginx-deployment" executed in 0s\n')),(0,r.kt)("p",null,"Great, as expected, the new version has been updated."),(0,r.kt)("h3",{id:"destroy"},"Destroy"),(0,r.kt)("p",null,"To destroy the resources allocated in the right order:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"gc destroy\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Destroy summary for provider k8s                                                                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Namespace          \u2502 myapp                                                                                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Service            \u2502 myapp::nginx-service                                                                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Deployment         \u2502 myapp::nginx-deployment                                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2714 Are you sure to destroy 3 resources, 3 types on 1 provider? \u2026 yes\nDestroying resources on 1 provider: k8s\n\u2713 k8s\n  \u2713 Initialising\n  \u2713 Destroying\n    \u2713 Namespace 1/1\n    \u2713 Service 1/1\n    \u2713 Deployment 1/1\n  \u2713 default::onDestroyed\n3 resources destroyed, 3 types on 1 provider\nRunning OnDestroyedGlobal resources on 1 provider: k8s\nCommand "gc d" executed in 1m 17s\n')),(0,r.kt)("p",null,"At this stage, all the Kubernetes resources should have been destroyed.\nWe could try to run ",(0,r.kt)("em",{parentName:"p"},"gc destroy")," command again, nothing should be destroyed or deployed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"gc d\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-txt"},'Find Deletable resources on 1 provider: k8s\n\u2713 k8s\n  \u2713 Initialising\n  \u2713 Listing 7/7\n\nNo resources to destroy\nRunning OnDestroyedGlobal resources on 1 provider: k8s\nCommand "gc d" executed in 0s\n')),(0,r.kt)("p",null,"As expected, the ",(0,r.kt)("em",{parentName:"p"},"destroy")," command is idempotent."),(0,r.kt)("h2",{id:"debugging"},"Debugging"),(0,r.kt)("p",null,"A benefit of using a general-purpose programming such as Javascript, is debugging. Thanks ",(0,r.kt)("a",{parentName:"p",href:"https://code.visualstudio.com/"},"Visual Studio Code")," for providing such an easy way to debug Javascript applications."),(0,r.kt)("p",null,"This example contains a vs code file called ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/grucloud/grucloud/blob/main/examples/k8s/tuto1/.vscode/launch.json"},"launch.json"),", which defines various debug targets for ",(0,r.kt)("inlineCode",{parentName:"p"},"gc apply"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"gc destroy")," and so on."),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"This tutorial described how to deploy, list, and destroy Kubernetes manifests from Javascript code.\nIn this case, a namespace, a service, and a deployment."),(0,r.kt)("p",null,"What's next? Let's see how to deploy a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/grucloud/grucloud/tree/main/examples/starhackit/minikube"},"full stack application on minikube"),"."),(0,r.kt)("p",null,"Ready to try Kubernetes on EKS, the Amazon Elastic Kubernetes Service? Have a look at the project ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/grucloud/grucloud/tree/main/examples/starhackit/eks-lean"},"full stack application on EKS"),"."),(0,r.kt)("p",null,"Maybe you prefer using ",(0,r.kt)("a",{parentName:"p",href:"https://kops.sigs.k8s.io/"},"kops")," to set up your cluster? The tutorial ",(0,r.kt)("a",{parentName:"p",href:"https://dev.to/fredericheem/setup-kops-on-aws-with-grucloud-oia"},"Setup Kops on AWS with Grucloud")," explains how to automate the ",(0,r.kt)("em",{parentName:"p"},"kops")," setup"),(0,r.kt)("p",null,"Are you looking to install the ",(0,r.kt)("em",{parentName:"p"},"cert manager"),", ",(0,r.kt)("em",{parentName:"p"},"web ui dashboard"),", ",(0,r.kt)("em",{parentName:"p"},"prometheus"),", and more? Browse the ",(0,r.kt)("a",{parentName:"p",href:"https://www.grucloud.com/docs/k8s/K8sModules"},"GruCloud K8s Modules")," and find out how to install and use these npm packages into your code."))}u.isMDXComponent=!0}}]);